---
title: "Practical 2 - Effect size and power"
author: "Dr. Christopher Wilson"
Subtitle: "PSY4179 Research Methods 1"
Institution: "Teesside University"
format:
  html:
    css: ["../include/glossary.css","../include/booktem.css", "../include/webex.css"]
    include-in-header: ["../include/webex.js"]
---

```{r setup, include=FALSE}
library(webexercises)
library(dplyr)
```

::: {.callout-tip collapse="true"}
# How to approach this practical session

1.  Have RStudio open and ready to use.
2.  Be sure to read the contextual information and instructions carefully. This information is necessary to complete the tasks.
3.  Complete the tasks as you go along - they are labelled "Task".
4.  Some of the code you need will be completed, some will be partially completed, some you will need to do yourself. You can copy code examples from this page by clicking on the clipboard icon {{< fa clipboard >}} which appears when you hover over the code examples.
5.  Buttons to press in your keyboard are shown like this: <pc>Ctrl + S</pc> or <mac>Cmd + S</mac>.
6.  Menu items to click in R Studio are shown like this: <if>File -\> Save</if>. Panes or Tabs in R Studio are also shown like this: <if>Environment</if>.
7.  On this page, boxes with a drop down arrow {{< fa square-caret-down >}} can be collapsed to hide the information inside them. You can also click on the {{< fa square-caret-right >}} arrow to expand the section.
:::

::: {.callout-important collapse="false"}
# Download the data for this practical

For this session you will need to download the following dataset: [practical2_data.csv](practical2_data.csv)

Right click and select <if>Save link as...</if> to download the file. Save it in the same folder as your script.

## Reminder: Importing data into R

To import data into R, you can use the a command that relates to the type of data you are importing. For example, to import the data in the file **practical2_data.csv**, you would use the following command:

```{r}
practical2_data <- read.csv("practical2_data.csv")
```

You can also use the menu to import data. To do this, click on the <if>Import Dataset</if> button and select the type of data you want to import. For example, to import the data in the file **practical2_data.csv**, you would click on <if>From Text (readr)</if> and then select the file **practical2_data.csv**.
:::

## Using packages in R

R has many built-in functions, but you can also add extra functions by installing packages. To install a package, you can use the <func>install.packages()</func> function. For example, to install the package <pkg>dplyr</pkg>, you would use the following command:

```{r eval=FALSE}
install.packages("dplyr") #<1>
```

1.  you only need to install a package once.

Once a package is installed, you can load it into your R session using the <func>library()</func> function. For example, to load the package <pkg>dplyr</pkg>, you would use the following command:

```{r warning=FALSE, message=FALSE}
library(dplyr) #<1>
```

1.  you need to load a package every time you start a new R session. It is good practice to load all the packages you need at the start of your script.

::: callout-note
# Task 1

1.  Install the package <pkg>dplyr</pkg>.
2.  Load the package <pkg>dplyr</pkg>.
:::

## Using the pipe operator to chain commands

Often in our analysis, we want to perform a series of operations on our data. For example, we might want to filter the data, then summarise it, then plot it. In R, we can do this by chaining commands together using the pipe operator **\%\>\%**.

This is made using the <pc>\%</pc>, <pc>\></pc> and <pc>\%</pc> keys on your keyboard.

The purpose of the pipe operator is to make your code easier to read. For example, consider the following code:

```{r eval = FALSE, warning=FALSE, message=FALSE}

filter(practical2_data, age > 25)   #<1>
```

1.  The above code uses the <func>filter()</func> function to select only the rows of the dataset where the age is greater than 25.

However, for more complicated analysis, code can be difficult to read. Now consider the following code:

```{r eval = FALSE, warning=FALSE, message=FALSE}
practical2_data %>% filter(age > 25) #<1>
```

1.  The above code starts with the data and then uses the pipe operator to "pass" that information to the next function. Because of this,we don't need to specify the dataset in the <func>filter()</func> function. The code also goes from left to right, which makes it easier to read.

# Let's do some descriptive statistics

## Filtering data

One of the things that the <pkg>dplyr</pkg> package allows you to do is to filter data. This is useful if you want to select only certain rows of data. For example, if you wanted to select only the data for the participants who were over the age of 21, you would use the following command:

```{r eval = FALSE, warning=FALSE, message=FALSE}
library(dplyr)
practical2_data %>% filter(age > 21) #<1>
```

1.  The first argument is the name of the dataset you want to filter. The second argument is the condition you want to filter by. In this case, we are filtering the data so that only rows where the age is greater than 21 are selected.

::: callout-note
# Task

We can only include participants who are over the age of 18 in our analysis.

Filter the data so that only rows where the age is greater than 18 are selected.

Save the result to an object called **data_over18**.
:::

```{r echo=FALSE}

data_over18 <- practical2_data %>% filter( age > 18)
n_over18 <- practical2_data %>% filter( age > 18) %>% count()

```

::: {.webex-check .webex-box}
The number of participants over the age of 18 is `r fitb(n_over18$n)`.
:::

## Summarising data

Another feature of the <pkg>dplyr</pkg> package is the ability to summarise data. This is useful if you want to calculate descriptive statistics for your data. For example, if you wanted to calculate the mean age of the Treatment and Control groups (over 18), you would use the following code:

```{r eval = FALSE, warning=FALSE, message=FALSE}

data_over18 %>% group_by(treatment_group) %>% summarise(mean_age = mean(age)) #<1>
```

1.  The code above uses the <func>group_by()</func> function to group the data by the variable **treatment_group**. It then uses the <func>summarise()</func> function to calculate the mean age for each group.

::: callout-note
# Task

Adapt the above code to calculate the standard deviation of the age for each group.

Save the result to an object called **age_sd**.
:::

# Calculating effect size

There are many ways to calculate effect size. This depends on the type of data you have and the type of analysis you are doing.

The most common measure of effect size for a between groups design (2 groups) is Cohen's d. Cohen's d is calculated as the difference between the means of the two groups divided by the pooled standard deviation.

$$d = \frac{\bar{x}_1 - \bar{x}_2}{s_p}$$

where $\bar{x}_1$ is the mean of group 1, $\bar{x}_2$ is the mean of group 2, and $s_p$ is the pooled standard deviation.

We can use packages in R to help us calculate Cohen's d. The <func>cohen.d()</func> function from the <pkg>effsize</pkg> package calculates Cohen's d.

```{r eval=FALSE}

# install the effsize package

install.packages("effsize") #<1>


```

1.  Remember, you only need to install a package once. If you have already installed the package, you do not need to run this code.

Now we can load the package and calculate the effect size.

```{r message=FALSE, warning=FALSE}

# load the effsize package

library(effsize) #<1>

effect_size <- cohen.d(outcome ~ treatment_group, data = data_over18, within = F) #<2>

effect_size #<3>


```

1.  This code loads the effsize package. Remember, you only need to load a package once when you open RStudio.
2.  This code calculates the effect size using the <func>cohen.d()</func> function. The first argument is the outcome variable and the second argument is the treatment group variable.
3.  This code prints the effect size to the console.

::: callout-note
# Task

Calculate the effect size for the difference between the means.

Save the result to an object called **effect_size**.
:::

::: {.webex-check .webex-box}
The effect size is `r fitb(effect_size$estimate %>% round(2))`.
:::

# Calculate the sample size for conducting a new study, based on this effect

::: {.callout-tip collapse="true"}
# Conducting power analysis in R

There are many ways to do power analysis and there are many tools for doing so. We will use the power.t.test() function to conduct a power analysis for a t-test.

For other study designs, there are other functions. For example, for a one-way ANOVA, you can use the function power.anova.test(). For a chi-square test, you can use the function power.prop.test(). For a paired t-test, you can use the function power.t.test() with the argument paired = TRUE.

There are also different packages that allow more complicated power analysis. Some packages for power analysis in R include:

-   webpower
-   pwr
:::

Imagine that you want to conduct a new study, based on the effect size you have found in this study. You want to conduct a study with 80% power, and an alpha level of 0.05. What sample size would you need to conduct this study?

To figure this out, we need to use a power analysis. We will use the power.t.test() function in R. This function requires the following arguments:

-   d = effect size
-   sig.level = alpha level
-   power = power
-   type = "two.sample" (because we have two groups)

```{r echo=TRUE, message=FALSE, warning=FALSE, eval=FALSE}

power.t.test(d = effectSize, sig.level = 0.05, power = 0.8, type = "two.sample") #<1>

```

1.  In the above code, replace the word "effectSize" with the effect size you calculated above.

::: {.callout-tip collapse="true"}
# What is power?

Power is the probability of rejecting the null hypothesis when it is false. In other words, it is the probability of finding a significant effect (in your study) when there is a true effect. The higher this value is, the less likely you are to make a type II error (failing to reject the null hypothesis when it is false). 0.8 is a common value for power in power analysis calculations.
:::

::: callout-note
# Task

Calculate the sample size required for conducting a new study, based on this effect
:::

```{r echo=FALSE, message=FALSE, warning=FALSE}

sampleSize <- power.t.test(d = effect_size$estimate, sig.level = 0.05, power = 0.8, type = "two.sample")$n %>% round(0)

```

::: {.webex-check .webex-box}
The required sample size is: `r fitb(sampleSize)` (no decimal places)
:::

::: callout-note
# Task

Save your script.
:::

# You are done for today {{< fa hands-clapping >}}

::: {.callout-tip collapse="true"}
# Further resources for conducting analysis in R

-   [Exploratory and descriptive analysis](https://christopherjwilson.github.io/intro_to_r/descriptive_stats.html)

-   [Basic statistics in R](https://christopherjwilson.github.io/intro_to_r/basic_tests.html)

-   [Power analysis in R](https://christopherjwilson.github.io/intro_to_r/power_effectSize.html)
:::
